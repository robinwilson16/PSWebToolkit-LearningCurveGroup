/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/getaddress-autocomplete-native@2.2.1/lib/Autocomplete.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __awaiter=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(n,o){function u(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(u,a)}l((i=i.apply(t,e||[])).next())}))};import{AddressSelectedEvent,AddressSelectedFailedEvent,SuggestionsEvent,SuggestionsFailedEvent}from"./Events";export default class Autocomplete{constructor(t,e,s){this.input=t,this.client=e,this.attributeValues=s,this.onInputFocus=()=>{this.attributeValues.options.select_on_focus&&this.input.select()},this.onInputPaste=()=>{setTimeout((()=>{this.populateList()}),100)},this.onInput=t=>{if(this.list&&t instanceof InputEvent==0&&t.target instanceof HTMLInputElement){const e=t.target;Array.from(this.list.querySelectorAll("option")).every((t=>t.value!==e.value||(this.handleSuggestionSelected(t),!1)))}},this.onKeyUp=t=>{this.debug(t),this.handleKeyUp(t)},this.onKeyDown=t=>{this.debug(t),this.handleKeyDownDefault(t)},this.debug=t=>{this.attributeValues.options.debug&&console.log(t)},this.handleComponentBlur=(t=!1)=>{clearTimeout(this.blurTimer);const e=t?0:100;this.blurTimer=setTimeout((()=>{this.clearList()}),e)},this.handleSuggestionSelected=t=>__awaiter(this,void 0,void 0,(function*(){if(this.attributeValues.options.enable_get){this.input.value="",this.attributeValues.options.clear_list_on_select&&this.clearList();const e=t.dataset.id;if(e){const t=yield this.client.get(e);if(t.isSuccess){let s=t.toSuccess();AddressSelectedEvent.dispatch(this.input,e,s.address),this.attributeValues.options.input_focus_on_select&&(this.input.focus(),this.input.setSelectionRange(this.input.value.length,this.input.value.length+1))}else{const s=t.toFailed();AddressSelectedFailedEvent.dispatch(this.input,e,s.status,s.message)}}}else this.clearList()})),this.handleKeyDownDefault=t=>{let e=t.key&&(1===t.key.length||"Unidentified"===t.key),s=" "===t.key?0:this.attributeValues.options.delay;e&&(clearTimeout(this.filterTimer),this.filterTimer=setTimeout((()=>{this.input.value.length>=this.attributeValues.options.minimum_characters?this.populateList():this.clearList()}),s))},this.handleKeyUp=t=>{if(t&&("Backspace"===t.code||"Delete"===t.code)){t.target==this.input&&(clearTimeout(this.filterTimer),this.filterTimer=setTimeout((()=>{this.input.value.length<this.attributeValues.options.minimum_characters?this.clearList():this.populateList()}),this.attributeValues.options.delay))}},this.populateList=()=>__awaiter(this,void 0,void 0,(function*(){var t;const e={all:!0,top:this.attributeValues.options.suggestion_count,template:'<option value="{formatted_address_0}">{formatted_address_1}{formatted_address_1,, }{formatted_address_2}{formatted_address_2,, }{formatted_address_3}{formatted_address_4,, }{formatted_address_4}{postcode,, }{postcode}</option>',show_postcode:this.attributeValues.options.show_postcode};this.attributeValues.options.filter&&(e.filter=this.attributeValues.options.filter);const s=null===(t=this.input.value)||void 0===t?void 0:t.trim(),i=yield this.client.autocomplete(s,e);if(i.isSuccess){const t=i.toSuccess(),e=[];if(this.list&&t.suggestions.length){for(let s=0;s<t.suggestions.length;s++){const i=this.getListItem(t.suggestions[s],s);e.push(i)}this.list.replaceChildren(...e)}else this.clearList();SuggestionsEvent.dispatch(this.input,s,t.suggestions)}else{const t=i.toFailed();SuggestionsFailedEvent.dispatch(this.input,s,t.status,t.message)}})),this.clearList=()=>{this.list&&this.list.replaceChildren()},this.getListItem=(t,e)=>{let s=this.htmlToNode(t.address);s.dataset.id=t.id;for(let t=0;t<e;t++)s.value=s.value+" ";return s},this.htmlToNode=t=>{const e=document.createElement("template");e.innerHTML=t,t&&(t=t.trim());if(1!==e.content.childNodes.length)throw new Error("html parameter must represent a single node");return e.content.firstChild}}destroy(){this.destroyInput(),this.destroyList()}destroyList(){this.list&&this.list.remove()}destroyInput(){this.input.removeAttribute("list"),this.input.removeEventListener("focus",this.onInputFocus),this.input.removeEventListener("paste",this.onInputPaste),this.input.removeEventListener("keydown",this.onKeyDown),this.input.removeEventListener("keyup",this.onKeyUp),this.input.removeEventListener("input",this.onInput)}build(){this.input.setAttribute("list",`${this.attributeValues.listId}`),this.input.addEventListener("focus",this.onInputFocus),this.input.addEventListener("paste",this.onInputPaste),this.input.addEventListener("keydown",this.onKeyDown),this.input.addEventListener("keyup",this.onKeyUp),this.input.addEventListener("input",this.onInput),this.list=document.createElement("DATALIST"),this.list.id=this.attributeValues.listId,this.input.insertAdjacentElement("afterend",this.list)}}
//# sourceMappingURL=/sm/37f7dbb21d4553a916e37d46539260ff2233c9472b79460f60163a3efded9db5.map